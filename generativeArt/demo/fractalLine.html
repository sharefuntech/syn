<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>fractal line</title>
</head>
<body>
	<canvas id="vizContainer" width='800px' height='600px'></canvas>
<script>
	canvasApp();

	function canvasApp() {
		var theCanvas = document.getElementById('vizContainer');
		var context = theCanvas.getContext('2d');

		var lineColor;
		var lineWidth;

		init();

		function init() {
			lineColor = '#333';
			lineWidth = 3;

			generate();

			theCanvas.addEventListener('click', clickListener, false);
		}

		function clickListener(evt) {
			context.clearRect(0, 0, theCanvas.width, theCanvas.height);
			generate();
		}

		function setLinePoints(iterations) {
			var pointList = {};
			pointList.first = {x:0, y:1};
			var lastPoint = {x:1, y:1};
			var minY = 1;
			var maxY = 1;
			var point;
			var nextPoint;
			var dx, newX, newY;

			pointList.first.next = lastPoint;
			for(var i = 0; i < iterations; i++) {
				console.log('round: ' + i);
				point = pointList.first;
				while (point.next != null) {
					nextPoint = point.next;

					dx = nextPoint.x - point.x;
					newX = 0.5 * (point.x + nextPoint.x);
					newY = 0.5 * (point.y + nextPoint.y);
					newY += dx * (Math.random() * 2 - 1);

					var newPoint = {x:newX, y:newY};
					console.log('newPoint is { x:' + newPoint.x + ', y:' + newPoint.y + '}');

					if (newY < minY) {
						minY = newY;
					}
					else if (newY > maxY) {
						maxY = newY;
					}

					newPoint.next = nextPoint;
					point.next = newPoint;

					point = nextPoint;
				}
			}

			if (maxY != minY) {
				var normalizeRate = 1 / (maxY - minY);
				point = pointList.first;
				while (point.next != null) {
					point.y = normalizeRate * (point.y - minY);
					point = point.next;
				}
			} else { //max = min with iterations = 0
				point = pointList.first;
				while (point != null) {
					point.y = 1;
					point = point.next;
				}
			}
			// console.log(pointList);
			return pointList;
		}

		function generate() {
			var point;
			var y0 = 400;
			var y1 = 100;
			var x0 = 10;
			var x1 = 600;

			var pointList = setLinePoints(3);

			context.strokeStyle = lineColor;
			context.lineWidth = lineWidth;
			context.beginPath();
			point = pointList.first;
			context.moveTo(x0+(x1-x0)*point.x, y0+(y1-y0)*point.y);

			while(point.next != null) {
				point = point.next;
				context.lineTo(x0+(x1-x0)*point.x, y0+(y1-y0)*point.y);
			}
			context.stroke();

			context.strokeStyle = 'rgba(255, 0, 0, 0.7)';
			context.lineWidth = 2;
			context.strokeRect(x0, y0, x1-x0, y1-y0);
		}
	}
</script>
</body>
</html>






















