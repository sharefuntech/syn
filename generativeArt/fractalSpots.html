<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>fractal spots</title>
</head>
<body>
	<canvas id="vizContainer" width='800px' height='600px'></canvas>
<script>
	canvasApp();
	function canvasApp() {
		var theCanvas = document.getElementById('vizContainer');
		var context = theCanvas.getContext('2d');
		var displayWidth = theCanvas.width;
		var displayHeight = theCanvas.height;

		init();

		function init() {
			generate();

			theCanvas.addEventListener('click', clickListener, false);
		}

		function clickListener(evt) {
			context.clearRect(0, 0, theCanvas.width, theCanvas.height);
			generate();
		}

		function setLinePoints(iterations) {
			var pointList = {};
			pointList.first = {x:0, y:1};
			var lastPoint = {x:1, y:1};
			var minY = 1;
			var maxY = 1;
			var point;
			var nextPoint;
			var dx, newX, newY;

			pointList.first.next = lastPoint;
			for (var i = 0; i < iterations; i++) {
				point = pointList.first;
				while (point.next != null) {
					nextPoint = point.next;

					dx = nextPoint.x - point.x;
					newX = 0.5 * (point.x + nextPoint.x);
					newY = 0.5 * (point.y + nextPoint.y);
					newY += dx * (Math.random() * 2 - 1);

					var newPoint = {x:newX, y:newY};

					if (newY < minY) {
						minY = newY;
					} else if (newY > maxY) {
						maxY = newY;
					}

					newPoint.next = nextPoint;
					point.next = newPoint;

					point = nextPoint;
				}
			}

			if (maxY != minY) {
				var normalizeRate = 1 / (maxY - minY);
				point = pointList.first;
				while (point != null) {
					point.y = normalizeRate * (point.y - minY);
					point = point.next;
				}
			} else {
				point = pointList.first;
				while (point != null) {
					point.y = 1;
					point = point.next;
				}
			}

			return pointList;
		}

		function generate() {
			var centerX, centerY;
			var r, g, b, a;
			var color;
			var lineW;
			var maxRad, minRad;
			var phase;

			for (var i = 0; i < 10; i++) {
				maxRad = 80 + Math.random() * 80;
				minRad = 0.3 * maxRad;

				centerX = maxRad + Math.random() * (displayWidth - 2 * maxRad);
				centerY = maxRad + Math.random() * (displayHeight - 2 * maxRad);

				r = Math.floor(Math.random() * 255);
				g = Math.floor(Math.random() * 255);
				b = Math.floor(Math.random() * 255);
				a = 0.2;
				color = 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';

				phase = Math.random() * Math.PI * 2;

				drawCircle(centerX, centerY, minRad, maxRad, phase, color);
			}
		}

		function drawCircle(centerX, centerY, minRad, maxRad, phase, color) {
			var point;
			var rad, theta;
			var twoPi = 2 * Math.PI;
			var x0, y0;

			var pointList = setLinePoints(9);

			context.strokeStyle = color;
			context.lineWidth = 1;
			context.fillStyle = color;
			context.beginPath();
			point = pointList.first;
			theta = phase;
			rad = minRad + point.y * (maxRad - minRad);
			x0 = centerX + rad * Math.cos(theta);
			y0 = centerY + rad * Math.sin(theta);
			context.lineTo(x0, y0);

			while (point.next != null) {
				point = point.next;
				theta = twoPi * point.x + phase;
				rad = minRad + point.y * (maxRad - minRad);
				x0 = centerX + rad * Math.cos(theta);
				y0 = centerY + rad * Math.sin(theta);
				context.lineTo(x0, y0);
			}

			context.stroke();
			context.fill();
		}
	}
</script>
</body>
</html>























