<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="initial-scale = 1">
	<title>适配移动设备屏幕</title>
	<script src = "lib/d3.js"></script>
	<style>
		html, body {
			margin: 0;
			padding: 0;
			/*html body 100%是在移动设备中完全拉伸svg的关键！！！*/
			width: 100%;
			height: 100%;
		}

		/*div容器设置为必要条件*/
		#vizContainer {
			width: 100%;
			height: 100%;
		}
		
		/*svg容器设置为必要条件*/
		svg {
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body>
	<div id="vizContainer">
		<svg></svg>
	</div>
	<script>
	// *********************************************************
	// *********************************************************
	// svg弹性适配不同尺寸屏幕移动设备的关键
	// 1、html body div容器 svg容器的width和height设置100%
	// 2、svg的viewbox设置为svg大小
	// *********************************************************
	// *********************************************************
	//=============================================================
	//测试设备屏幕大小 ===============================================
	var svg = d3.select('svg');
	var svgNode = d3.select('svg').node();

	var deviceWidth = screen.width;
	var deviceHeight = screen.height;
	// 不直接用screen.width是因为设备屏幕大小，还包括浏览器菜单栏地址栏等尺寸，和浏览器可用显示区域不一致，而包裹在div中的svg，正好表示为浏览器可用尺寸
	var screenWidth = parseFloat(svgNode.clientWidth || svgNode.parent.clientWidth);
	var screenHeight = parseFloat(svgNode.clientHeight || svgNode.parent.clientHeight);
	
	// 设置viewbox才能保证旋转屏幕弹性调整svg图片
	svg.attr('viewBox', '0 0 ' + screenWidth + ' ' + screenHeight);
	// console.log('device screen width: ' + deviceWidth, ',device screen height: ' + deviceHeight);
	// console.log('browser screen width: ' + screenWidth, ',browser screen height: ' + screenHeight);

	//这里需要根据设备屏幕而不是浏览器可用屏幕进行判断
	if (deviceWidth < 400) { 
		createImage(screenWidth, screenHeight, 'red');
	}
	else if (deviceWidth < 1000) {
		createImage(screenWidth, screenHeight, 'green');
	}
	else {
		createImage(screenWidth, screenHeight, 'blue');
	}

	function createImage (width, height, color) {
		var r = d3.min([width, height]) / 2;

		svg.append('circle')
			.attr('cx', 0)
			.attr('cy', 0)
			.attr('r', r)
			.attr('transform', 'translate(' + (width / 2) + ',' + (height / 2) + ')')
			.attr('fill', color);
	}
	//==============================================================
	</script>
</body>
</html>