function draw(a){return line(dimensions.map(function(b){return[x(b.name),b.scale(a[b.name])]}))}function showMouseTooltip(a){mouseTooltip.style("opacity",1).style("z-index",10),mouseTooltip.html(generateMouseTooltipContent(a)).style("left",function(){var a=screen.width;return d3.event.pageX<a/2?d3.event.pageX+"px":d3.event.pageX-160+"px"}).style("top",d3.event.pageY+"px")}function hideMouseTooltip(){mouseTooltip.style("opacity",0)}function generateMouseTooltipContent(a){var b=[],c=[],d="";for(key in a)b.push(a[key]),c.push(key),d+="<div>"+key+": "+a[key]+"</div>";return console.log(d),d}var margin={top:30,right:40,bottom:20,left:100},width=1e3-margin.left-margin.right,height=600-margin.top-margin.bottom,mouseTooltip=d3.select("body").append("div").attr("class","mouseTooltip").style("opacity",0),color=d3.scale.category10(),dimensions=[{name:"区域",scale:d3.scale.ordinal().rangePoints([0,height]),type:String},{name:"年份",scale:d3.scale.linear().range([height,0]),type:Number},{name:"单位GDP用水总量_立方米每万元",scale:d3.scale.linear().range([height,0]),type:Number},{name:"单位GDP能源消耗总量_公斤每万元",scale:d3.scale.linear().range([height,0]),type:Number},{name:"单位产值建设用地消耗_亩每亿元",scale:d3.scale.linear().range([height,0]),type:Number},{name:"单位GDP固定资产投资_元每万元",scale:d3.scale.linear().range([height,0]),type:Number}],x=d3.scale.ordinal().domain(dimensions.map(function(a){return a.name})).rangePoints([0,width]),line=d3.svg.line().defined(function(a){return!isNaN(a[1])}),yAxis=d3.svg.axis().orient("left"),svg=d3.select("body").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),dimension=svg.selectAll(".dimension").data(dimensions).enter().append("g").attr("class","dimension").attr("transform",function(a){return"translate("+x(a.name)+")"});d3.csv("data/sample.csv",function(a){function b(a){var b=[];a.forEach(function(a){a.年份=+a.年份,a.指标值=+a.指标值,a[a.指标名称]=a.指标值;var c={};c["区域"]=a.区域,c["年份"]=a.年份,c[a.指标名称]=a.指标值,b.push(c)});var c=d3.nest().key(function(a){return a.区域}).key(function(a){return a.年份}).entries(b),d=[],e="年份",f="区域";return c.forEach(function(a){var b=a.key;a.values.forEach(function(a){var c=+a.key,g={};g[e]=c,g[f]=b,a.values.forEach(function(a){for(key in a)key!=f&&key!=e&&(g[key]=a[key])}),d.push(g)})}),d}function c(a){svg.classed("active",!0),f.classed("inactive",function(b){return b!==a}),f.filter(function(b){return b===a}).each(e),showMouseTooltip(a)}function d(a){svg.classed("active",!1),f.classed("inactive",!1),hideMouseTooltip()}function e(){this.parentNode.appendChild(this)}a=b(a),dimensions.forEach(function(b){b.scale.domain(b.type===Number?d3.extent(a,function(a){return+a[b.name]}):a.map(function(a){return a[b.name]}).sort())}),svg.append("g").attr("class","background").selectAll("path").data(a).enter().append("path").attr("d",draw),svg.append("g").attr("class","foreground").selectAll("path").data(a).enter().append("path").attr({fill:"none",stroke:function(a,b){return color(a.区域)},"stroke-width":"1.5px"}).attr("d",draw),dimension.append("g").attr("class","axis").each(function(a){d3.select(this).call(yAxis.scale(a.scale))}).append("text").attr("class","title").attr("text-anchor","middle").attr("y",-9).text(function(a){return a.name}),svg.select(".axis").selectAll("text:not(.title)").attr("class","label").data(a,function(a){return a.name||a});var f=svg.selectAll(".axis text,.background path,.foreground path").on("mouseover",c).on("mouseout",d)});