/* (C)2015 @animateddata */"use strict";var animdata=animdata||{};animdata.data=function(){var a={};return a.data=[],a.init=function(b){d3.csv("data/data.csv",function(c,d){a.data=d,b()})},a}();var animdata=animdata||{};animdata.chart=function(){function a(a){var b={mixed:"A mix","?":"No response",all:"All","15-19":"15-19yrs","20-24":"20-24yrs","25-29":"25-29yrs","30-34":"30-34yrs","35-39":"35-39yrs","40-44":"40-44yrs","45+":"45+yrs","0-1":"Up to 2 years","2-5":"2 to 5 years","6-9":"6 to 9 years","10-13":"10 to 13 years","14-17":"14 to 17 years","18+":"18+ years","0-100":"£0-100","100-199":"£100-199","200-299":"£200-299","300-399":"£300-399","400-499":"£400-499","500-749":"£500-749","750-999":"£750-999","1000+":"£1000+",fixed:"Fixed",notUsually:"Deposit not usually asked for",CON:"Content",DES:"Design","DES/DEV":"Design & development",DEV:"Development",MAN:"Management",MAR:"Marketing",OTH:"Other",SYS:"System administration","UI/UX":"User interface/experience",agencies:"Subcontracting with agencies",direct:"Directly with clients",freelancers:"In partnership with other freelancers"};return _.has(b,a)?b[a]:a}function b(){var a={};_.each(t,function(b,c){a[c]={},_.each(b,function(b,d){a[c][b]=d})}),t=a}function c(a,b){var c={};if(_.has(s,b.colorBy))c=s[b.colorBy];else{var d=_.map(a,function(a){return a[b.colorBy]});d=_.uniq(d),_.each(d,function(a,b){c[a]=r(b)})}return c["?"]="#eee",c}function d(a,b){var d=c(a,b);_.each(a,function(a){if("none"===b.colorBy)return void(a.layout.color=null);var c=a[b.colorBy];a.layout.color=_.has(d,c)?d[c]:null})}function e(a,b){var c={};p=[],_.each(a,function(a){a.layout={},a.geometry={}}),_.each(a,function(a){var d=a[b.groupBy];"none"===b.groupBy&&(d="all"),_.has(c,d)||(c[d]=[]),c[d].push(a)}),d(a,b),_.each(c,function(a,b){p.push({name:b,members:a})});var e=null;_.has(t,b.sortBy)&&(e=t[b.sortBy]),_.each(p,function(a){a.members=_.sortBy(a.members,function(a){return e?e[a[b.sortBy]]:a[b.sortBy]})}),e=null,_.has(t,b.groupBy)&&(e=t[b.groupBy]),p=_.sortBy(p,function(a){return e?e[a.name]:a.name});var f,g=20,h=o.cellSize+o.cellPadding;_.each(p,function(a){_.each(a.members,function(a,b){a.geometry.x=b%o.numCols*h,a.geometry.y=g+Math.floor(b/o.numCols)*h,f=a.geometry.y}),g=f+o.groupSpacing})}function f(b){var c=q.cells.selectAll("rect").data(b);c.enter().append("rect").on("mouseover",function(a){j(a)}).on("mousemove",function(a){i(a)}).on("mouseout",function(a){k(a)}),c.attr("width",o.cellSize).attr("height",o.cellSize).transition().duration(1e3).attr("x",function(a){return a.geometry.x}).attr("y",function(a){return a.geometry.y}).style("fill",function(a){return a.layout.color}),c=q.cells.selectAll("text").data(p),c.enter().append("text"),c.exit().remove(),c.text(function(b){return a(b.name)}).attr("y",function(a){return a.members[0].geometry.y-4})}function g(b,d){var e=c(b,d);e=_.map(e,function(a,b){return{name:b,color:a}}),"none"===d.colorBy&&(e={}),q.legend.select("h3").classed("active",_.keys(e).length>0);var f=null;_.has(t,d.colorBy)&&(f=t[d.colorBy]),e=_.sortBy(e,function(a){return f?f[a.name]:a.name});var g=q.legend.selectAll("div.item").data(e);g.enter().append("div").classed("item",!0),g.exit().remove(),g.style("border-color",function(a){return a.color}).text(function(b){return a(b.name)})}function h(b){var c=[{label:"Age",key:"age"},{label:"Gender",key:"gender"},{label:"Location",key:"location"},{label:"Day rate (£/day)",key:"dayRateCat"},{label:"Skillset",key:"skillset"}],d="<table>";return _.each(c,function(c){d+="<tr><td>"+c.label+":</td><td>"+a(b[c.key])+"</td></tr>"}),d+="</table>"}function i(a){var b=d3.mouse(q.container.node()),c=b[0]+5;b[1]+=5,c>.8*m?c-=o.tooltipWidth+10:c>.4*m&&(c-=.5*o.tooltipWidth),q.tooltip.html(h(a)).style("left",c+"px").style("top",b[1]+"px")}function j(a){q.tooltip.style("display","block").transition().style("opacity",1),i(a)}function k(a){q.tooltip.transition().style("opacity",0)}function l(){var a=p[p.length-1],b=a.members[a.members.length-1],c=b.geometry.y;q.svg.attr("height",c+50+"px")}var m,n={},o={cellSize:20,cellPadding:1,numCols:20,groupSpacing:60,tooltipWidth:230},p=[],q={},r=d3.scale.category20c(),s={age:{"15-19":"#f0f9e8","20-24":"#ccebc5","25-29":"#a8ddb5","30-34":"#7bccc4","35-39":"#4eb3d3","40-44":"#2b8cbe","45+":"#08589e"},dayRateCat:{"0-100":"#f7fcf0","100-199":"#e0f3db","200-299":"#ccebc5","300-399":"#a8ddb5","400-499":"#7bccc4","500-749":"#4eb3d3","750-999":"#2b8cbe","1000+":"#08589e"},requestDeposit:{notUsually:"#bbb","0-10%":"#f0f9e8","10-25%":"#bae4bc","25-50%":"#7bccc4","50+%":"#2b8cbe",fixed:"#fbb4b9"},gender:{Male:"#7fcdbb",Female:"#edf8b1"},charge:{"By the hour":"#f0f9e8","By the day":"#bae4bc","By the week":"#7bccc4","By the month":"#2b8cbe","By the project":"#fdcc8a","Varies per project":"#bbb"},yearsFreelance:{"0-1":"#f0f9e8","2-5":"#ccebc5","6-9":"#a8ddb5","10-13":"#7bccc4","14-17":"#43a2ca","18+":"#0868ac"}},t={age:["15-19","20-24","25-29","30-34","35-39","40-44","45+"],dayRateCat:["0-100","100-199","200-299","300-399","400-499","500-749","750-999","1000+"],requestDeposit:["notUsually","0-10%","10-25%","25-50%","50+%","fixed"],gender:["Female","Male"],location:["East Midlands","East of England","London","North East","Northern Ireland","North West","Scotland","South East","South West","Wales","West Midlands","Yorkshire & The Humber"],skillset:["DES","DEV","DES/DEV","UI/UX","SYS","MAR","CON","MAN","OTH"],charge:["By the hour","By the day","By the week","By the month","By the project","Varies per project"],yearsProfessional:["0-1","2-5","6-9","10-13","14-17","18+"],yearsFreelance:["0-1","2-5","6-9","10-13","14-17","18+"],workRelationships:["direct","freelancers","agencies","mixed","all"]};return n.update=function(a,b){e(a,b),f(a),g(a,b),l()},n.updateWidth=function(a,b,c){m=a,q.svg.attr("width",.91*a+"px"),o.cellSize=.9*a/o.numCols-o.cellPadding,e(b,c),f(b),l()},n.init=function(){q.container=d3.select("#chart"),q.svg=q.container.select("svg"),q.cells=q.svg.select("g.cells"),q.legend=d3.select("#wrapper .sidebar .legend"),q.tooltip=q.container.select(".tooltip"),b()},n}();var animdata=animdata||{};animdata.menu=function(){function a(a){d3.select(this).append("text").classed("label",!0).text(a.label);var b=d3.select(this).append("select").on("change",function(a){e.menuSelect(a.name,this.options[this.selectedIndex].value)});b.selectAll("option").data(function(a){return a.options}).enter().append("option").attr("value",function(a){return a.name}).text(function(a){return a.label})}function b(){d3.select("#wrapper .sidebar .menu").selectAll("div").data(d).enter().append("div").classed("select",!0).each(a)}var c={},d=[{name:"groupBy",label:"Group by",options:[{label:"No grouping",name:"none"},{label:"Age",name:"age"},{label:"Day rate (£/day)",name:"dayRateCat"},{label:"Typical size of deposit?",name:"requestDeposit"},{label:"Gender",name:"gender"},{label:"Location",name:"location"},{label:"Skillset",name:"skillset"},{label:"How do you charge?",name:"charge"},{label:"How long a freelancer (yrs)",name:"yearsFreelance"},{label:"Working relationships",name:"workRelationships"}]},{name:"colorBy",label:"Colour by",options:[{label:"No colour",name:"none"},{label:"Age",name:"age"},{label:"Day rate (£/day)",name:"dayRateCat"},{label:"Typical size of deposit?",name:"requestDeposit"},{label:"Gender",name:"gender"},{label:"Location",name:"location"},{label:"Skillset",name:"skillset"},{label:"How do you charge?",name:"charge"},{label:"How long a freelancer (yrs)",name:"yearsFreelance"},{label:"Working relationships",name:"workRelationships"}]}],e={};return c.init=function(a){e=a,b()},c.updateVisibility=function(a){d3.select("#wrapper .sidebar .menu").classed("active",a)},c}();var animdata=animdata||{};animdata.story=function(){function a(a){e.html(a)}function b(){if(h+=1,h===f.length)return a("<div>Now it's your chance to explore the data. You can choose how you want to group and colour the respondents using the two menus below.</div><div>Survey and data by <a href='http://cole007.net/'>Cole Henley</a>.</div><div>Visualisation design and build by <a href='http://animateddata.co.uk'>Peter Cook</a>.</div>"),d3.select("#wrapper .sidebar .buttons").style("display","none"),void g.newChapter(!1);d3.select("#wrapper .sidebar .buttons .prev.button").classed("active",!0);var b=f[h];a(b.copy),g.newChapter(b)}function c(){h-=1,0===h&&d3.select("#wrapper .sidebar .buttons .prev.button").classed("active",!1);var b=f[h];a(b.copy),g.newChapter(b)}var d={},e=d3.select("#wrapper .sidebar .about .copy"),f=[{groupBy:"none",colorBy:"none",copy:"<div>This is an interactive visualisation of results from Cole Henley's <a href='http://ournameismud.co.uk/blog/article/2014-freelance-rates-results-what-people-charge'>2014 Freelance Rates survey</a>.</div><div>There were 566 respondents and each is represented by a single cell in this visualisation.</div>You can hover over (or touch) a cell to find out more about each of the respondents.</div>"},{groupBy:"location",colorBy:"location",copy:"<div>Responses came from all over the UK but there is clearly a bias towards London and the South.</div>"},{groupBy:"skillset",colorBy:"skillset",copy:"<div>The majority of respondents were either designers or developers, with more than twice as many developers as designers.</div>"},{groupBy:"dayRateCat",colorBy:"dayRateCat",copy:"<div>There's a large variance of rates, ranging from less than £100 per day through to over £1000 a day.</div><div>Most respondents are in the £200 to £400 range.</div>"},{groupBy:"skillset",colorBy:"dayRateCat",copy:"<div>If we group by skill we can see that certain skills attract the top rates.</div><div>Of those who responded, only developers, system administrators and managers have day rates above £1000.</div>"},{groupBy:"age",colorBy:"age",copy:"<div>The majority of respondents are in the 25-35 years age range with a drop off in numbers of over 40s.</div>"},{groupBy:"age",colorBy:"dayRateCat",copy:"<div>However the 40-44yrs bracket has a greater proportion of high day rates than any other age group.</div><div>That's not to say it's not possible to earn a good day rate at a younger age. There's a respondent in the 15-19yr bracket charging £500-749 a day!</div>"}],g={},h=0;return d.init=function(d){g=d,d3.select("#wrapper .sidebar .buttons .next").on("click",b),d3.select("#wrapper .sidebar .buttons .prev").on("click",c),a(f[0].copy)},d}();var animdata=animdata||{};animdata.main=function(){function a(){var a;window.onresize=function(c){clearTimeout(a),a=setTimeout(function(){b()},200)}}function b(){{var a=1100,b=900,c=window,d=document,e=d.documentElement,i=d.getElementsByTagName("body")[0],j=c.innerWidth||e.clientWidth||i.clientWidth;c.innerHeight||e.clientHeight||i.clientHeight}if(j>a&&(j=a),g.wrapper.style("width",j+"px"),j>b){var k=Math.floor(.5*j)-2*h.containerPadding;g.chart.style("width",k+"px"),animdata.chart.updateWidth(k,animdata.data.data,f.uiState),g.sidebar.style("width",k+"px").style("position","absolute"),g.wrapper.classed("portrait",!1)}else{var l=j-2*h.containerPadding;g.chart.style("width",l+"px"),g.sidebar.style("width",l+"px").style("position","static"),g.wrapper.classed("portrait",!0),animdata.chart.updateWidth(l,animdata.data.data,f.uiState)}}function c(a,b){f.uiState[a]=b,"colorBy"===a&&(f.uiState.sortBy=b),animdata.chart.update(animdata.data.data,f.uiState)}function d(a){return a?(f.uiState.groupBy=a.groupBy,f.uiState.colorBy=a.colorBy,f.uiState.sortBy=a.colorBy,animdata.chart.update(animdata.data.data,f.uiState),void animdata.menu.updateVisibility(!f.uiState.storyIsActive)):(f.uiState.storyIsActive=!1,animdata.menu.updateVisibility(!f.uiState.storyIsActive),f.uiState.groupBy="none",f.uiState.colorBy="none",void animdata.chart.update(animdata.data.data,f.uiState))}function e(){b()}var f={};f.uiState={groupBy:"none",colorBy:"none",sortBy:"none",storyIsActive:!0};var g={},h={containerPadding:20};return f.go=function(){animdata.data.init(e),g.wrapper=d3.select("#wrapper"),g.chart=d3.select("#chart"),g.sidebar=g.wrapper.select(".sidebar"),animdata.chart.init(),animdata.story.init({newChapter:d}),animdata.menu.init({menuSelect:c}),a()},f}(),animdata.main.go();