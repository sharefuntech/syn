<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>C10 sample svg graph</title>
	<script src="lib/vue.js"></script>
	<script src="lib/d3.js"></script>
	<style media="screen">
	body {
	font-family: Helvetica Neue, Arial, sans-serif;
	}

	polygon {
	fill: #42b983;
	opacity: .75;
	}

	circle {
	fill: transparent;
	stroke: #999;
	}

	text {
	font-family: Helvetica Neue, Arial, sans-serif;
	font-size: 10px;
	fill: #666;
	}

	label {
	display: inline-block;
	margin-left: 10px;
	width: 20px;
	}

	#raw {
	position: absolute;
	top: 0;
	left: 300px;
	}
	</style>
</head>
<body>

<!-- component template of polygraph-->
<script type="text/x-template" id="polygraph-template">
	<g>
		<polygon :points='points'></polygon>
		<circle cx='100' cy='100' r='80'></circle>
		<axis-label
			v-for='stat in stats'
			:stat='stat'
			:index='$index'
			:total='stats.length'>
		</axis-label>
	</g>
</script>

<!-- component template of polygraph-->
<script type="text/x-template" id="axis-label-template">
	<text :x='point.x' :y='point.y'>{{ stat.label }}</text>
</script>

<!-- root element -->
<div id="demo">
	<!-- component -->
	<svg width="200" height="200">
		<polygraph :stats='stats'></polygraph>
	</svg>
	<!-- control -->
	<div v-for="stat in stats">
		<label for="">{{ stat.label }}</label>
		<input type="range" v-model='stat.value' min='0' max='100'>
		<span>{{ stat.value }}</span>
		<button @click='remove(stat)'>x</button>
	</div>
	<form id='add'>
		<input name="newLabel" v-model="newLabel">
		<button @click='add'>add a stat</button>
	</form>
	<pre id="raw">{{ stats | json}}</pre>
</div>

<!-- view-model and model -->
<script type="text/javascript">
// raw data
var stats = [
	{ label: 'a', value: 100 },
	{ label: 'b', value: 100 },
	{ label: 'c', value: 100 },
	{ label: 'd', value: 100 },
	{ label: 'e', value: 100 }
];

// component
Vue.component('polygraph', {
	props: ['stats'],
	template: '#polygraph-template',
	replace: true,
	computed: {
		points: function() {
			var total = this.stats.length;
			return this.stats.map(function(stat, i) {
				var point = valueToPoint(stat.value, i, total);
			}).join(' ');
		}
	},
	components: {
		'axis-label': {
			props: {
				stat: Object,
				index: Number,
				total: Number
			},
			template: '#axis-label-template',
			replace: true,
			computed: {
				point: function() {
					return valueToPoint(+this.stat.value+10, this.index, this.total)
				}
			}
		}
	}

});

function valueToPoint(value, index, total) {
	var x = 0;
	var y = -value * 0.8;
	var angle = Math.PI * 2 / total * index;
	var cos = Math.cos(angle);
	var sin = Math.sin(angle);
	var tx = x * cos - y * sin + 100;
	var ty = x * sin + y * cos + 100;
	return {
		x: tx,
		y: ty
	}
}

new Vue({
	el: '#demo',
	data: {
		newLabel: '',
		stats: stats
	},
	methods: {
		add: function(e) {
			e.preventDefault();
			if (!this.newLabel) {
				return;
			}
			this.stats.push({
				label: this.newLabel,
				value: 100
			});
			this.newLabel = '';
		},
		remove: function(stat) {
			if (this.stats.length > 3) {
				this.stats.$remove(stat);
			} else {
				alert('can\' delete more!');
			}
		}
	}
});
</script>
</body>
</html>
